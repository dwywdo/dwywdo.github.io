<!doctype html>
<html lang="en-us">
  <head>
    <title>Spring Dependencies // dwywdo</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.82.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="dwywdo" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://dwywdo.github.io/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring Dependencies"/>
<meta name="twitter:description" content="Dependency Injection    Dependency Injection의 정의는 이미 IoC를 정리할 때 확인하였다.
 It is a process whereby objects define their dependencies (that is, the other objects they work with) only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.
   DI 원칙이 지켜지면 객체가 자신의 의존성을 직접 관리할 필요 없이, 외부로부터 의존성을 주입받기 때문에 테스트에도 용이하다."/>

    <meta property="og:title" content="Spring Dependencies" />
<meta property="og:description" content="Dependency Injection    Dependency Injection의 정의는 이미 IoC를 정리할 때 확인하였다.
 It is a process whereby objects define their dependencies (that is, the other objects they work with) only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.
   DI 원칙이 지켜지면 객체가 자신의 의존성을 직접 관리할 필요 없이, 외부로부터 의존성을 주입받기 때문에 테스트에도 용이하다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dwywdo.github.io/post/spring-dependencies/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-05-06T20:48:03&#43;09:00" />
<meta property="article:modified_time" content="2021-05-06T20:48:03&#43;09:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://dwywdo.github.io"><img class="app-header-avatar" src="/images/dawn.jpeg" alt="dwywdo" /></a>
      <h1>dwywdo</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
            <br><br>
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p> </p>
      <div class="app-header-social">
        
          <a href="https://github.com/dwywdo" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Spring Dependencies</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 6, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://dwywdo.github.io/tags/spring/">Spring</a>
              <a class="tag" href="https://dwywdo.github.io/tags/dependencies/">Dependencies</a>
              <a class="tag" href="https://dwywdo.github.io/tags/di/">DI</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h2 id="dependency-injection">Dependency Injection</h2>
<hr>
<ul>
<li>
<p>Dependency Injection의 정의는 이미 IoC를 정리할 때 확인하였다.</p>
<blockquote>
<p><em>It is a process whereby objects define their dependencies (that is, the other objects they work with) only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method.</em></p>
</blockquote>
</li>
<li>
<p>DI 원칙이 지켜지면 객체가 자신의 의존성을 직접 관리할 필요 없이, 외부로부터 의존성을 주입받기 때문에 테스트에도 용이하다.</p>
<ul>
<li>특히, 의존성이 상위의 추상 클래스나 인터페이스에 존재하도록 구현되면 Mocking 등의 관점에서 테스트하기도 쉬워진다.</li>
</ul>
</li>
</ul>
<h2 id="di의-두-가지-종류">DI의 두 가지 종류</h2>
<hr>
<ul>
<li>DI는 두 가지 방식으로 적용될 수 있다.
<ul>
<li><code>Constructor-based DI</code></li>
<li><code>Setter-based DI</code></li>
</ul>
</li>
</ul>
<h3 id="constructor-based-di">Constructor-based DI</h3>
<ul>
<li>IoC 컨테이너가 해당 객체 타입 클래스의 생성자를 인자와 함께 호출하면서 수행되는 방식</li>
<li>인자들은 그 각각이 의존성을 나타낸다.</li>
<li>빈을 생성하기 위해 특정한 인자와 함께 <code>static</code> 팩토리 메소드를 호출하는 것과 거의 동일하다.
<ul>
<li><code>static</code> 팩토리 메소드에 대응하는 것이 생성자인 셈</li>
</ul>
</li>
<li>아래의 예는 의존성을 생성자 기반으로만 주입받는 클래스의 예이다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleMovieLister</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// SimpleMovieLister -&gt; MovieFinder로의 의존성이 존재한다.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> MovieFinder movieFinder<span style="color:#f92672">;</span>

  <span style="color:#75715e">// 스프링 컨테이너가 의존성을 주입하기 위한 생성자
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">SimpleMovieLister</span><span style="color:#f92672">(</span>MovieFinder movieFinder<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">movieFinder</span> <span style="color:#f92672">=</span> movieFinder<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>일반 POJO와 크게 다르지 않음을 확인할 수 잇다.</li>
</ul>
</li>
</ul>
<h4 id="constructor-argument-resolution">Constructor Argument Resolution</h4>
<ul>
<li>생성자는 의존성을 주입하기 위해 인자의 타입에 주목한다.</li>
<li>생성자 인자들에 특별히 모호함이 없다면, Bean Definition 내에 존재된 생성자 인자들의 순서가 곧 빈이 생성될 때 의존성을 주입받는 순서가 된다.</li>
<li>아래의 경우를 보자
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> x.y<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThingOne</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ThingOne</span><span style="color:#f92672">(</span>ThingTwo thingTwo<span style="color:#f92672">,</span> ThingThree thingThree<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//...
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>ThingTwo</code> - <code>ThingThree</code>가 서로 상속관계에 있는 것이 아니라면, 모호함이 존재하지 않는다.
<ul>
<li>여기서의 모호함이란? 자바에서는 메소드 인자 타입을 명시할 때에, 상위 클래스의 타입으로 하위 클래스의 인스턴스를 받을 수 있기 때문에 만약 여기서 ThingTwo가 ThingThree를 상속하는 클래스였다면 컨테이너 입장에서는 어떤 타입의 객체를 의존성 주입에 사용해야 할 지 알 수 없고 이런 경우를 모호하다고 하는 것.</li>
</ul>
</li>
<li>즉, 아래의 XML 설정만으로 충분하다. (인자의 타입, 인덱스와 같은 부수 정보 없이 순서만으로 Resolution이 가능)
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;beans&gt;</span>
  <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;beanOne&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.ThingOne&#34;</span><span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;beanTwo&#34;</span><span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;beanThree&#34;</span><span style="color:#f92672">/&gt;</span>
  <span style="color:#f92672">&lt;/bean&gt;</span>
  <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;beanTwo&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.ThingTwo&#34;</span><span style="color:#f92672">/&gt;</span>
  <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;beanThree&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.ThingThree&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/beans&gt;</span>
</code></pre></div></li>
<li>다른 빈이 의존성으로 주입되는 경우 빈 자체가 클래스를 기반으로 정의되기 때문에 타입을 명확하게 파악할 수 있지만, 아래의 경우처럼 Primitive / Simple 타입의 경우에는 모호함이 존재할 수 있다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> examples<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Number of years to calculate the Ultimate Answer
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> years<span style="color:#f92672">;</span>
    <span style="color:#75715e">// The Answer to Life, the Universe, and Everything
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> String ultimateAnswer<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ExampleBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> years<span style="color:#f92672">,</span> String ultimateAnswer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">years</span> <span style="color:#f92672">=</span> years<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ultimateAnswer</span> <span style="color:#f92672">=</span> ultimateAnswer<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>그래서 아래처럼 설정 내에 타입 혹은 인덱스를 명시해주면 그제서야 컨테이너가 의존성 주입을 제대로 할 수 있게 된다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">index=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">index=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>인자 이름을 명시해주어 이런 모호함을 해결할 수도 있다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;years&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;ultimateAnswer&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><ul>
<li>다만 이 경우에는 컴파일 시 디버그 플래그를 활성화시켜야 생성자로부터 인자 이름을 스프링이 파악할 수 있게 된다.</li>
<li>그러고 싶지 않다면? <code>@ConstructorProperties</code> JDK 애노테이션을 사용하면 된다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> examples<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Fields omitted
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@ConstructorProperties</span><span style="color:#f92672">({</span><span style="color:#e6db74">&#34;years&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;ultimateAnswer&#34;</span><span style="color:#f92672">})</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ExampleBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> years<span style="color:#f92672">,</span> String ultimateAnswer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">years</span> <span style="color:#f92672">=</span> years<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ultimateAnswer</span> <span style="color:#f92672">=</span> ultimateAnswer<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="setter-based-di">Setter-based DI</h3>
<ul>
<li>Setter-based DI의 경우 컨테이너가 인자가 없는 생성자 혹은 <code>static</code> 팩토리 메소드를 <code>invoke</code> 한 뒤에, 빈에 존재하는 setter 메소드를 호출함으로써 수행되는 방식</li>
<li>아래의 예는 Setter-based DI로만 의존성을 주입받는 클래스의 예이다.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SimpleMovieLister</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// the SimpleMovieLister has a dependency on the MovieFinder
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> MovieFinder movieFinder<span style="color:#f92672">;</span>
  <span style="color:#75715e">// a setter method so that the Spring container can inject a MovieFinder
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setMovieFinder</span><span style="color:#f92672">(</span>MovieFinder movieFinder<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">movieFinder</span> <span style="color:#f92672">=</span> movieFinder<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
  <span style="color:#75715e">// business logic that actually uses the injected MovieFinder is omitted...
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
<h2 id="constructor-based-di-vs-setter-based-di">Constructor-based DI vs. Setter-based DI</h2>
<hr>
<ul>
<li>스프링 문서에 이와 관련하여 적혀있는 내용이 있는데, 간략히 정리하면 아래와 같다.
<ul>
<li>생성자 기반 DI는 필수적인 의존성에, Setter 기반의 DI는 선택적인 의존성에 적용하는 것이 좋다.
<ul>
<li>Setter 기반 DI에도 <code>@Required</code> 애노테이션을 사용해 필수 의존성으로 만들어 줄 수 있다. 다만 잘 사용하지는 않는다.</li>
</ul>
</li>
<li>생성자 기반의 DI는 의존성이 주입될 당시에 완전히 초기화된 상태의 빈을 제공하고, Immutable한 객체에 적용하기 적합하여 주로 권장되는 방식</li>
<li>Setter 기반 DI의 장점은 빈이 생성된 후에도 다시 주입하는 것이 가능하다는 점이 있다.</li>
<li>외부 3rd party의 클래스를 사용하는 경우, setter를 제공하지 않아서 생성자 기반의 DI밖에 사용할 수 없게 되는 경우도 있다.</li>
</ul>
</li>
</ul>
<h2 id="dependency-resolution-과정">Dependency Resolution 과정</h2>
<hr>
<ul>
<li>먼저 <code>ApplicationContext</code>가 <code>Configuration metadata</code>에 의해 생성 및 초기화된다.</li>
<li>각각의 빈마다, 그의 의존성들을 이미 알고 있기 때문에 위의 방법들을 이용하여 빈들에 의존성을 주입해준다.</li>
<li>기본적으로 스프링은 Property 값들에 대해서 (문자열) 자바의 빌트인 타입인 <code>int</code>, <code>long</code>, <code>String</code>, <code>boolean</code> 등으로 변환하여 준다.</li>
</ul>
<h3 id="순환-참조-circular-dependencies">순환 참조 (Circular Dependencies)</h3>
<ul>
<li>A -&gt; B / B -&gt; A로의 의존성이 존재하게 되면 스프링은 런타임 도중 순환 참조를 확인하고 <code>BeanCurrentlyInCreationException</code>을 던지게 된다.
<ul>
<li>해당 예외의 이름에서도 알 수 있듯이, 각각의 빈을 생성하고 의존성으로 넣어주는 과정에서 발생하게 되는 것</li>
</ul>
</li>
<li>다만, 위의 경우는 생성자 기반의 DI에서 발생하기 때문에, 해결하기 위해서는 둘 중 하나의 DI를 Setter 방식으로 바꾸어줄 수 있다.
<ul>
<li>이 말은 권장되지는 않지만, Setter-based DI만 사용하면 순환 참조 의존성을 의도적으로 만들 수도 있다는 이야기이다.</li>
</ul>
</li>
</ul>
<h2 id="di-예제">DI 예제</h2>
<hr>
<ul>
<li>Setter-based DI XML &amp; Java Code</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">&lt;!-- setter injection using the nested ref element --&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;beanOne&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;ref</span> <span style="color:#a6e22e">bean=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/property&gt;</span>

    <span style="color:#75715e">&lt;!-- setter injection using the neater ref attribute --&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;beanTwo&#34;</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;integerProperty&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>

<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.AnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.YetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> AnotherBean beanOne<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> YetAnotherBean beanTwo<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBeanOne</span><span style="color:#f92672">(</span>AnotherBean beanOne<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanOne</span> <span style="color:#f92672">=</span> beanOne<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBeanTwo</span><span style="color:#f92672">(</span>YetAnotherBean beanTwo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanTwo</span> <span style="color:#f92672">=</span> beanTwo<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setIntegerProperty</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>Constructor-based DI XML &amp; Java Code</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">&lt;!-- constructor injection using the nested ref element --&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg&gt;</span>
        <span style="color:#f92672">&lt;ref</span> <span style="color:#a6e22e">bean=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/constructor-arg&gt;</span>

    <span style="color:#75715e">&lt;!-- constructor injection using the neater ref attribute --&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>

    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>

<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.AnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.YetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> AnotherBean beanOne<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> YetAnotherBean beanTwo<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> i<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ExampleBean</span><span style="color:#f92672">(</span>
        AnotherBean anotherBean<span style="color:#f92672">,</span> YetAnotherBean yetAnotherBean<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanOne</span> <span style="color:#f92672">=</span> anotherBean<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanTwo</span> <span style="color:#f92672">=</span> yetAnotherBean<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> i<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>빈 설정 자체에서 <code>static</code> factory method를 사용하도록 설정한 경우</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span> <span style="color:#a6e22e">factory-method=</span><span style="color:#e6db74">&#34;createInstance&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>

<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;anotherExampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.AnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;yetAnotherBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.YetAnotherBean&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">// a private constructor
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">ExampleBean</span><span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">...</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// a static factory method; the arguments to this method can be
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// considered the dependencies of the bean that is returned,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// regardless of how those arguments are actually used.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ExampleBean <span style="color:#a6e22e">createInstance</span> <span style="color:#f92672">(</span>
        AnotherBean anotherBean<span style="color:#f92672">,</span> YetAnotherBean yetAnotherBean<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        ExampleBean eb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ExampleBean <span style="color:#f92672">(...);</span>
        <span style="color:#75715e">// some other operations...
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> eb<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
